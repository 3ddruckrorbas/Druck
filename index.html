<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rorbas 3D Druck | Enrique & Jack</title>
    <link rel="icon" type="image/svg+xml" href="https://lucide.dev/favicon.ico" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (für JSX Support im Browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              brand: {
                50: '#f0f9ff',
                100: '#e0f2fe',
                200: '#bae6fd',
                300: '#7dd3fc',
                400: '#38bdf8',
                500: '#0ea5e9',
                600: '#0284c7',
                700: '#0369a1',
                800: '#075985',
                900: '#0c4a6e',
              }
            },
            animation: {
              fadeIn: 'fadeIn 0.5s ease-out',
              slideUp: 'slideUp 0.5s ease-out',
              scaleIn: 'scaleIn 0.3s ease-out',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              },
              slideUp: {
                '0%': { opacity: '0', transform: 'translateY(20px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              },
              scaleIn: {
                '0%': { opacity: '0', transform: 'scale(0.9)' },
                '100%': { opacity: '1', transform: 'scale(1)' },
              }
            }
          },
        },
      }
    </script>
    <style>
      body {
        background-color: #0f172a;
        color: #f8fafc;
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- ICONS ---
        const Icon = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );

        // 3D Printer Icon
        const Printer = (props) => <Icon {...props}>
            <path d="M5 21h14" />
            <path d="M5 21V7a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v14" />
            <path d="M19 10H5" />
            <rect x="10" y="8" width="4" height="4" />
            <rect x="8" y="16" width="8" height="2" />
        </Icon>;
        
        const Menu = (props) => <Icon {...props}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></Icon>;
        const X = (props) => <Icon {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></Icon>;
        const ArrowRight = (props) => <Icon {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></Icon>;
        const ArrowLeft = (props) => <Icon {...props}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></Icon>;
        const Box = (props) => <Icon {...props}><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" x2="12" y1="22.08" y2="12"/></Icon>;
        const Zap = (props) => <Icon {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></Icon>;
        const Heart = (props) => <Icon {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></Icon>;
        const ClipboardList = (props) => <Icon {...props}><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></Icon>;
        const Settings = (props) => <Icon {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.72l-.15.1a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.72l.15-.1a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></Icon>;
        const Truck = (props) => <Icon {...props}><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><path d="M15 18H9"/><path d="M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14"/><circle cx="17" cy="18" r="2"/><circle cx="7" cy="18" r="2"/></Icon>;
        const Send = (props) => <Icon {...props}><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></Icon>;
        const AlertCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></Icon>;
        const CheckCircle2 = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></Icon>;
        const Sparkles = (props) => <Icon {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></Icon>;
        const Info = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></Icon>;
        const Mail = (props) => <Icon {...props}><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></Icon>;
        const MapPin = (props) => <Icon {...props}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></Icon>;
        const Upload = (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></Icon>;
        const Trash2 = (props) => <Icon {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></Icon>;
        const Paperclip = (props) => <Icon {...props}><path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></Icon>;
        const ChevronDown = (props) => <Icon {...props}><path d="m6 9 6 6 6-6"/></Icon>;
        const HelpCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></Icon>;
        const Tag = (props) => <Icon {...props}><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"/><path d="M7 7h.01"/></Icon>;
        const ShieldBan = (props) => <Icon {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m4.6 16.4 14.8-8.4"/></Icon>;
        const Lock = (props) => <Icon {...props}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></Icon>;
        const User = (props) => <Icon {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>;
        const Edit = (props) => <Icon {...props}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></Icon>;
        const ExternalLink = (props) => <Icon {...props}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></Icon>;
        const Database = (props) => <Icon {...props}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></Icon>;
        const RefreshCw = (props) => <Icon {...props}><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></Icon>;
        const ServerIcon = (props) => <Icon {...props}><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></Icon>;
        const Plus = (props) => <Icon {...props}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></Icon>;
        const Eye = (props) => <Icon {...props}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></Icon>;
        const EyeOff = (props) => <Icon {...props}><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/><line x1="2" x2="22" y1="2" y2="22"/></Icon>;
        const Key = (props) => <Icon {...props}><path d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4"/></Icon>;


        // --- CONSTANTS ---
        
        const ADMIN_USER = 'AdminRorbas'; // Legacy constant, kept for reference if needed
        const BLACKLISTED_IDS = ["example-id-123456"];

        const ORDER_STATUS = {
            PENDING: { id: 'pending', label: 'Eingegangen', color: 'bg-slate-500', text: 'text-slate-200' },
            IN_PROGRESS: { id: 'in_progress', label: 'In Bearbeitung', color: 'bg-blue-500', text: 'text-blue-200' },
            DONE: { id: 'done', label: 'Fertig', color: 'bg-green-500', text: 'text-green-200' },
            SHIPPED: { id: 'shipped', label: 'Abgeholt / Versendet', color: 'bg-purple-500', text: 'text-purple-200' },
        };

        const EMAIL_RECIPIENT = "3d.druck.rorbas@gmail.com";
        const CUSTOM_FILAMENT_SURCHARGE = 3.00;
        
        const ViewState = {
            HOME: 'HOME',
            ORDER: 'ORDER',
            SUCCESS: 'SUCCESS',
            BANNED: 'BANNED',
            AGB: 'AGB',
            MY_ORDERS: 'MY_ORDERS',
            ADMIN_LOGIN: 'ADMIN_LOGIN',
            ADMIN_DASHBOARD: 'ADMIN_DASHBOARD'
        };

        // --- HELPERS & SERVICES ---

        const generateUUID = () => {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        };

        const getDeviceId = () => {
            let id = localStorage.getItem('rorbas_device_id');
            if (!id) {
                id = generateUUID();
                localStorage.setItem('rorbas_device_id', id);
            }
            return id;
        };

        // --- SERVER API SERVICE ---
        
        const API_URL = '/api';

        const ApiService = {
            getOrders: async (deviceId) => {
                const query = deviceId ? `?deviceId=${deviceId}` : '';
                // Add Cache-Control headers to ensure we always get fresh data
                const res = await fetch(`${API_URL}/orders${query}`, {
                    headers: { 'Cache-Control': 'no-cache', 'Pragma': 'no-cache' }
                });
                return await res.json();
            },
            addOrder: async (data, deviceId) => {
                const res = await fetch(`${API_URL}/orders`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ...data, deviceId })
                });
                return await res.json();
            },
            updateOrder: async (id, updates) => {
                const res = await fetch(`${API_URL}/orders/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });
                return await res.json();
            },
            deleteOrder: async (id) => {
                const res = await fetch(`${API_URL}/orders/${id}`, { method: 'DELETE' });
                return await res.json();
            },
            
            // Filament Routes
            getFilaments: async () => {
                try {
                    const res = await fetch(`${API_URL}/filaments`);
                    return await res.json();
                } catch(e) { return []; }
            },
            addFilament: async (data) => {
                const res = await fetch(`${API_URL}/filaments`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return await res.json();
            },
            updateFilament: async (id, updates) => {
                const res = await fetch(`${API_URL}/filaments/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });
                return await res.json();
            },
            deleteFilament: async (id) => {
                const res = await fetch(`${API_URL}/filaments/${id}`, { method: 'DELETE' });
                return await res.json();
            },

            // Auth & Settings Routes
            login: async (password, deviceId) => {
                const res = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ password, deviceId })
                });
                if (!res.ok) throw new Error('Ungültiges Passwort');
                return await res.json();
            },
            verify2FA: async (code, deviceId) => {
                const res = await fetch(`${API_URL}/auth/verify`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ code, deviceId })
                });
                if (!res.ok) throw new Error('Ungültiger Code');
                return await res.json();
            },
            getPasswords: async () => {
                 try {
                    const res = await fetch(`${API_URL}/admin/passwords`);
                    return await res.json();
                } catch(e) { return []; }
            },
            addPassword: async (password) => {
                const res = await fetch(`${API_URL}/admin/passwords`, {
                     method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ password })
                });
                return await res.json();
            },
            deletePassword: async (password) => {
                 const res = await fetch(`${API_URL}/admin/passwords/${encodeURIComponent(password)}`, {
                     method: 'DELETE'
                });
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.error || 'Fehler beim Löschen');
                }
                return await res.json();
            }
        };

        // --- COMPONENTS ---

        const Button = ({ 
            variant = 'primary', 
            size = 'md', 
            className = '', 
            children, 
            ...props 
        }) => {
            const baseStyles = "inline-flex items-center justify-center rounded-lg font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 disabled:opacity-50 disabled:cursor-not-allowed";
            const variants = {
                primary: "bg-brand-600 hover:bg-brand-500 text-white shadow-lg shadow-brand-500/20 focus:ring-brand-500",
                secondary: "bg-slate-700 hover:bg-slate-600 text-white focus:ring-slate-500",
                outline: "border-2 border-slate-600 hover:border-brand-500 text-slate-300 hover:text-white bg-transparent",
                ghost: "text-slate-400 hover:text-white hover:bg-slate-800",
                danger: "bg-red-600 hover:bg-red-500 text-white shadow-lg shadow-red-500/20",
            };
            const sizes = {
                sm: "px-3 py-1.5 text-sm",
                md: "px-5 py-2.5 text-base",
                lg: "px-8 py-4 text-lg",
            };
            return (
                <button className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${className}`} {...props}>
                    {children}
                </button>
            );
        };

        // AGB View
        const AGBView = ({ onBack }) => (
            <div className="max-w-4xl mx-auto py-12 px-4 sm:px-6 animate-fadeIn">
                <div className="mb-6">
                    <Button onClick={onBack} variant="ghost" size="sm" className="gap-2 pl-0 hover:bg-transparent hover:text-brand-400">
                        <ArrowLeft className="h-4 w-4" /> Zurück
                    </Button>
                </div>
                <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl border border-slate-700 p-8 shadow-2xl">
                    <h1 className="text-3xl font-bold text-white mb-8">Allgemeine Geschäftsbedingungen (AGB)</h1>
                    <div className="space-y-6 text-slate-300">
                        {/* AGB Content Shortened for Brevity - Keeping Structure */}
                         <section><h2 className="text-xl font-semibold text-white mb-2">§1 Geltungsbereich</h2><p>Diese Allgemeinen Geschäftsbedingungen gelten für die Nutzung der Webseite https://3ddruckrorbas.github.io/Druck/ durch private Nutzer.</p></section>
                         <section><h2 className="text-xl font-semibold text-white mb-2">§2 Art des Angebots</h2><p>Die Webseite dient der Bereitstellung von Informationen sowie der Kontaktaufnahme im Zusammenhang mit privaten, nicht gewerblichen Leistungen im Bereich 3D-Druck.</p></section>
                        <section><h2 className="text-xl font-semibold text-white mb-2">§3 Vertragsschluss und Ablauf</h2><p>Anfrage: Der Kunde übermittelt dem Anbieter eine unverbindliche Anfrage (inkl. 3D-Modell/Datei und gewünschten Spezifikationen).

Offerte: Der Anbieter prüft die Anfrage und sendet dem Kunden eine kostenlose Offerte (Angebot) per E-Mail oder über das System zu. Diese Offerte ist, sofern nicht anders angegeben, für einen Zeitraum von [z. B. 14 Tagen] bindend.

Vertragsschluss: Der Vertrag kommt zustande, sobald der Kunde die Offerte ausdrücklich bestätigt hatt.

Dateneignung: Mit der Zusage bestätigt der Kunde, dass die übermittelten Daten final sind. Nachträgliche Änderungen am Modell nach Vertragsabschluss können zusätzliche Kosten verursachen.</p></section>
                         <section><h2 className="text-xl font-semibold text-white mb-2">§9 Anwendbares Recht</h2><p>Es gilt das Recht des schönen Schweizerlandes.</p></section>
                    </div>
                </div>
            </div>
        );

        // My Orders View
        const MyOrdersView = ({ deviceId, onBack }) => {
            const [orders, setOrders] = React.useState([]);
            const [loading, setLoading] = React.useState(true);

            React.useEffect(() => {
                ApiService.getOrders(deviceId).then(data => {
                    setOrders(data);
                    setLoading(false);
                });
            }, [deviceId]);

            return (
                <div className="max-w-4xl mx-auto py-12 px-4 sm:px-6 animate-fadeIn">
                    <div className="mb-6 flex justify-between items-center">
                         <Button onClick={onBack} variant="ghost" size="sm" className="gap-2 pl-0 hover:bg-transparent hover:text-brand-400">
                            <ArrowLeft className="h-4 w-4" /> Zurück
                        </Button>
                        <h2 className="text-xl font-bold text-white">Meine Bestellungen</h2>
                    </div>

                    {loading ? (
                        <div className="text-center py-20"><div className="animate-spin rounded-full h-8 w-8 border-b-2 border-brand-500 mx-auto"></div><p className="mt-2 text-slate-500">Lade Daten vom Server...</p></div>
                    ) : orders.length === 0 ? (
                        <div className="text-center py-20 bg-slate-800/30 rounded-2xl border border-slate-700 border-dashed">
                            <Box className="h-12 w-12 text-slate-600 mx-auto mb-4" />
                            <p className="text-slate-400">Du hast noch keine aktiven Bestellungen auf diesem Gerät.</p>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {orders.map(order => {
                                const status = ORDER_STATUS[order.status.toUpperCase()] || ORDER_STATUS.PENDING;
                                return (
                                    <div key={order.id} className="bg-slate-800 border border-slate-700 rounded-xl p-6 shadow-lg">
                                        <div className="flex flex-col md:flex-row md:items-start justify-between gap-4 mb-4">
                                            <div>
                                                <div className="flex items-center gap-2 text-sm text-slate-400 mb-1">
                                                    <span>{new Date(order.createdAt).toLocaleDateString()}</span>
                                                    <span>•</span>
                                                    <span className="font-mono text-xs">{order.id.slice(0,8)}</span>
                                                </div>
                                                <h3 className="text-lg font-bold text-white">{order.description}</h3>
                                                <p className="text-sm text-brand-400 mt-1">{order.material}</p>
                                                 {order.street && (<p className="text-xs text-slate-500 mt-2">Lieferung an: {order.street}, {order.zip} {order.city}</p>)}
                                            </div>
                                            <div className={`px-3 py-1 rounded-full text-sm font-bold border border-white/10 ${status.color} ${status.text} inline-flex items-center gap-2 self-start`}>
                                                {status.label}
                                            </div>
                                        </div>
                                        
                                        {order.adminNotes && (
                                            <div className="mt-4 pt-4 border-t border-slate-700 bg-slate-900/30 -mx-6 -mb-6 px-6 py-4 rounded-b-xl">
                                                <p className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Nachricht von Enrique & Jack:</p>
                                                <p className="text-slate-300 text-sm">{order.adminNotes}</p>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    )}
                </div>
            );
        };

        // Admin Login View
        const AdminLoginView = ({ onLogin, onBack }) => {
            const [step, setStep] = React.useState('password'); // 'password' or '2fa'
            const [password, setPassword] = React.useState('');
            const [showPassword, setShowPassword] = React.useState(false);
            const [code, setCode] = React.useState('');
            const [error, setError] = React.useState('');
            const [isLoading, setIsLoading] = React.useState(false);
            const deviceId = getDeviceId();

            const handlePasswordSubmit = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                setError('');
                try {
                    const res = await ApiService.login(password, deviceId);
                    if(res.success) {
                        if(res.require2FA) {
                            setStep('2fa');
                        } else {
                            onLogin("Admin");
                        }
                    }
                } catch(e) {
                    setError('Falsches Passwort');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleCodeSubmit = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                setError('');
                try {
                    const res = await ApiService.verify2FA(code, deviceId);
                    if(res.success) {
                        onLogin("Admin");
                    }
                } catch(e) {
                    setError('Falscher oder abgelaufener Code');
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="min-h-[80vh] flex items-center justify-center px-4 animate-fadeIn">
                    <div className="w-full max-w-md bg-slate-800 border border-slate-700 rounded-2xl p-8 shadow-2xl relative">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-white">
                                {step === 'password' ? 'Admin Login' : 'Sicherheits-Check'}
                            </h2>
                            <Button onClick={onBack} variant="ghost" size="sm"><X className="h-5 w-5"/></Button>
                        </div>

                        <div className="absolute top-2 right-2 text-[10px] text-slate-600 font-mono">ID: {deviceId.slice(0,6)}</div>
                        
                        {step === 'password' ? (
                            <form onSubmit={handlePasswordSubmit} className="space-y-4">
                                <div>
                                    <label className="block text-xs text-slate-400 mb-1">Passwort</label>
                                    <div className="relative">
                                        <input 
                                            type={showPassword ? "text" : "password"}
                                            value={password}
                                            onChange={e => setPassword(e.target.value)}
                                            className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 pr-10 text-white focus:ring-2 focus:ring-brand-500"
                                            placeholder="Passwort eingeben"
                                            autoFocus
                                        />
                                        <button 
                                            type="button" 
                                            onClick={() => setShowPassword(!showPassword)}
                                            className="absolute right-3 top-3 text-slate-400 hover:text-white"
                                        >
                                            {showPassword ? <EyeOff className="h-5 w-5"/> : <Eye className="h-5 w-5"/>}
                                        </button>
                                    </div>
                                </div>
                                {error && <p className="text-red-400 text-sm">{error}</p>}
                                <Button type="submit" disabled={isLoading} className="w-full">{isLoading ? 'Prüfe...' : 'Weiter'}</Button>
                            </form>
                        ) : (
                            <form onSubmit={handleCodeSubmit} className="space-y-4 animate-fadeIn">
                                <div className="p-3 bg-brand-900/20 border border-brand-500/20 rounded-lg text-sm text-brand-300 mb-4">
                                    Ein Sicherheitscode wurde an die Admin-Email gesendet. Bitte Code eingeben.
                                </div>
                                <div>
                                    <label className="block text-xs text-slate-400 mb-1">6-stelliger Code</label>
                                    <input 
                                        type="text" 
                                        value={code}
                                        onChange={e => setCode(e.target.value.replace(/[^0-9]/g, '').slice(0,6))}
                                        className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white text-center text-xl tracking-widest font-mono focus:ring-2 focus:ring-brand-500"
                                        placeholder="000000"
                                        autoFocus
                                    />
                                </div>
                                {error && <p className="text-red-400 text-sm">{error}</p>}
                                <Button type="submit" disabled={isLoading} className="w-full">{isLoading ? 'Verifiziere...' : 'Bestätigen'}</Button>
                                <button type="button" onClick={() => setStep('password')} className="w-full text-xs text-slate-500 hover:text-white mt-2">Zurück zum Passwort</button>
                            </form>
                        )}
                    </div>
                </div>
            );
        };

        // Filament Manager Component
        const FilamentManager = ({ filaments, onChange }) => {
            const [isAdding, setIsAdding] = React.useState(false);
            const [newFilament, setNewFilament] = React.useState({ name: '', color: '', colorHex: '#000000', material: 'PLA' });

            const handleAdd = async (e) => {
                e.preventDefault();
                const res = await ApiService.addFilament(newFilament);
                onChange(res);
                setIsAdding(false);
                setNewFilament({ name: '', color: '', colorHex: '#000000', material: 'PLA' });
            };

            const toggleStock = async (fil) => {
                const res = await ApiService.updateFilament(fil.id, { inStock: !fil.inStock });
                onChange(res);
            };

            const handleDelete = async (id) => {
                if(confirm("Filament wirklich löschen?")) {
                    const res = await ApiService.deleteFilament(id);
                    onChange(res);
                }
            };

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h3 className="text-lg font-bold text-white">Materialien & Farben</h3>
                        <Button onClick={() => setIsAdding(!isAdding)} size="sm" className="gap-2">
                            {isAdding ? <X className="h-4 w-4"/> : <Plus className="h-4 w-4"/>} 
                            {isAdding ? 'Abbrechen' : 'Neu'}
                        </Button>
                    </div>

                    {isAdding && (
                        <form onSubmit={handleAdd} className="bg-slate-900/50 p-4 rounded-xl border border-slate-700 animate-fadeIn grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label className="text-xs text-slate-400">Name (z.B. PLA Matt Schwarz)</label><input required className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white" value={newFilament.name} onChange={e=>setNewFilament({...newFilament, name: e.target.value})} /></div>
                            <div><label className="text-xs text-slate-400">Material (PLA/PETG/TPU)</label>
                                <select className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white" value={newFilament.material} onChange={e=>setNewFilament({...newFilament, material: e.target.value})}>
                                    <option value="PLA">PLA</option><option value="PETG">PETG</option><option value="TPU">TPU</option>
                                </select>
                            </div>
                            <div><label className="text-xs text-slate-400">Farbname (z.B. Schwarz)</label><input required className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white" value={newFilament.color} onChange={e=>setNewFilament({...newFilament, color: e.target.value})} /></div>
                            <div><label className="text-xs text-slate-400">Farbe (Hex)</label><div className="flex gap-2"><input type="color" className="h-10 w-10 bg-transparent border-0 cursor-pointer" value={newFilament.colorHex} onChange={e=>setNewFilament({...newFilament, colorHex: e.target.value})} /><input className="flex-1 bg-slate-800 border border-slate-600 rounded p-2 text-white font-mono" value={newFilament.colorHex} onChange={e=>setNewFilament({...newFilament, colorHex: e.target.value})} /></div></div>
                            <div className="md:col-span-2"><Button type="submit" className="w-full">Hinzufügen</Button></div>
                        </form>
                    )}

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {filaments.map(fil => (
                            <div key={fil.id} className={`p-4 rounded-xl border flex items-center justify-between ${fil.inStock ? 'bg-slate-800 border-slate-700' : 'bg-slate-900 border-slate-800 opacity-75'}`}>
                                <div className="flex items-center gap-3">
                                    <div className="w-8 h-8 rounded-full border border-slate-600 shadow-sm" style={{backgroundColor: fil.colorHex}}></div>
                                    <div>
                                        <div className="font-medium text-white text-sm">{fil.name}</div>
                                        <div className="text-xs text-slate-500">{fil.material} • {fil.color}</div>
                                    </div>
                                </div>
                                <div className="flex items-center gap-2">
                                    <button onClick={() => toggleStock(fil)} className={`p-2 rounded-lg transition-colors ${fil.inStock ? 'text-green-400 hover:bg-green-400/10' : 'text-slate-600 hover:bg-slate-700'}`} title={fil.inStock ? "Auf Lager" : "Ausverkauft"}>
                                        <CheckCircle2 className="h-5 w-5" />
                                    </button>
                                    <button onClick={() => handleDelete(fil.id)} className="p-2 text-slate-600 hover:text-red-400 hover:bg-red-400/10 rounded-lg transition-colors">
                                        <Trash2 className="h-5 w-5" />
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // Password Manager Component
        const PasswordManager = () => {
            const [passwords, setPasswords] = React.useState([]);
            const [newPassword, setNewPassword] = React.useState('');
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState('');

            const loadPasswords = async () => {
                const data = await ApiService.getPasswords();
                setPasswords(data);
                setLoading(false);
            };

            React.useEffect(() => {
                loadPasswords();
            }, []);

            const handleAdd = async (e) => {
                e.preventDefault();
                if(!newPassword.trim()) return;
                const updated = await ApiService.addPassword(newPassword);
                setPasswords(updated);
                setNewPassword('');
            };

            const handleDelete = async (pwd) => {
                if(confirm('Passwort wirklich löschen?')) {
                    try {
                        const updated = await ApiService.deletePassword(pwd);
                        setPasswords(updated);
                        setError('');
                    } catch(e) {
                        setError(e.message);
                    }
                }
            };

            return (
                 <div className="space-y-6">
                    <h3 className="text-lg font-bold text-white flex items-center gap-2"><Key className="h-5 w-5 text-brand-400"/> Admin Zugangsdaten</h3>
                    <p className="text-slate-400 text-sm">Hier können zusätzliche Passwörter für den Admin-Login hinterlegt werden. Diese werden sicher auf dem Server in <code>settings.json</code> gespeichert.</p>
                    
                    {error && <div className="p-3 bg-red-900/30 border border-red-500/30 rounded text-red-300 text-sm">{error}</div>}

                    <form onSubmit={handleAdd} className="flex gap-2">
                        <input 
                            type="text" 
                            className="flex-1 bg-slate-800 border border-slate-600 rounded p-2 text-white" 
                            placeholder="Neues Passwort..." 
                            value={newPassword}
                            onChange={e => setNewPassword(e.target.value)}
                        />
                        <Button type="submit" size="sm" className="whitespace-nowrap">Passwort hinzufügen</Button>
                    </form>

                    <div className="bg-slate-900/50 rounded-xl border border-slate-800 overflow-hidden">
                        {loading ? <div className="p-4 text-center text-slate-500">Lade...</div> : (
                            <ul className="divide-y divide-slate-800">
                                {passwords.map((pwd, idx) => (
                                    <li key={idx} className="p-4 flex items-center justify-between hover:bg-slate-800/50 transition-colors">
                                        <div className="font-mono text-slate-300">{pwd}</div>
                                        <button onClick={() => handleDelete(pwd)} className="text-slate-500 hover:text-red-400 p-1" title="Löschen">
                                            <Trash2 className="h-4 w-4" />
                                        </button>
                                    </li>
                                ))}
                            </ul>
                        )}
                    </div>
                </div>
            );
        };


        // Admin Dashboard
        const AdminDashboard = ({ currentUser, onLogout }) => {
            const [orders, setOrders] = React.useState([]);
            const [filaments, setFilaments] = React.useState([]);
            const [editingId, setEditingId] = React.useState(null);
            const [editForm, setEditForm] = React.useState({});
            const [loading, setLoading] = React.useState(true);
            const [activeTab, setActiveTab] = React.useState('orders'); // 'orders', 'filaments', 'settings'

            const loadData = () => {
                setLoading(true);
                Promise.all([
                    ApiService.getOrders(),
                    ApiService.getFilaments()
                ]).then(([ordersData, filamentsData]) => {
                    setOrders(ordersData);
                    setFilaments(filamentsData);
                    setLoading(false);
                });
            }

            React.useEffect(() => {
                loadData();
            }, []);

            const handleDeleteOrder = (id) => {
                if(confirm("Bestellung wirklich vom Server löschen?")) {
                    ApiService.deleteOrder(id).then(data => setOrders(data));
                }
            };

            const startEditOrder = (order) => {
                setEditingId(order.id);
                setEditForm({ status: order.status, adminNotes: order.adminNotes || '' });
            };

            const saveEditOrder = (id) => {
                ApiService.updateOrder(id, editForm).then(data => {
                    setOrders(data);
                    setEditingId(null);
                });
            };

            return (
                <div className="max-w-6xl mx-auto py-12 px-4 animate-fadeIn">
                    {/* Header */}
                    <div className="flex flex-col md:flex-row justify-between items-center mb-8 bg-slate-900/80 p-6 rounded-2xl border border-slate-700 shadow-xl backdrop-blur-md">
                        <div className="flex items-center gap-4 mb-4 md:mb-0">
                            <div className="w-12 h-12 bg-brand-600 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-brand-500/20">A</div>
                            <div>
                                <h1 className="text-2xl font-bold text-white tracking-tight">Admin Kommandozentrale</h1>
                                <div className="flex items-center gap-2 text-sm">
                                    <span className="flex h-2 w-2 relative"><span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span className="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span></span>
                                    <span className="text-green-400 font-medium">System Aktiv</span>
                                    <span className="text-slate-600 mx-2">|</span>
                                    <span className="text-slate-400">{currentUser}</span>
                                </div>
                            </div>
                        </div>
                        <Button onClick={onLogout} variant="ghost" size="sm" className="text-slate-400 hover:text-white">Abmelden</Button>
                    </div>

                    {/* Tabs */}
                    <div className="flex gap-4 mb-6 border-b border-slate-800 pb-1">
                        <button onClick={() => setActiveTab('orders')} className={`px-4 py-2 font-medium text-sm transition-colors relative ${activeTab === 'orders' ? 'text-brand-400' : 'text-slate-400 hover:text-white'}`}>
                            Bestellungen {activeTab === 'orders' && <div className="absolute bottom-[-5px] left-0 w-full h-0.5 bg-brand-400 rounded-full"></div>}
                        </button>
                        <button onClick={() => setActiveTab('filaments')} className={`px-4 py-2 font-medium text-sm transition-colors relative ${activeTab === 'filaments' ? 'text-brand-400' : 'text-slate-400 hover:text-white'}`}>
                            Materialien {activeTab === 'filaments' && <div className="absolute bottom-[-5px] left-0 w-full h-0.5 bg-brand-400 rounded-full"></div>}
                        </button>
                        <button onClick={() => setActiveTab('settings')} className={`px-4 py-2 font-medium text-sm transition-colors relative ${activeTab === 'settings' ? 'text-brand-400' : 'text-slate-400 hover:text-white'}`}>
                            Einstellungen {activeTab === 'settings' && <div className="absolute bottom-[-5px] left-0 w-full h-0.5 bg-brand-400 rounded-full"></div>}
                        </button>
                    </div>

                    <div className="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
                        {loading && activeTab !== 'settings' ? (
                             <div className="flex justify-center py-20"><div className="animate-spin rounded-full h-12 w-12 border-b-2 border-brand-500"></div></div>
                        ) : activeTab === 'filaments' ? (
                            <FilamentManager filaments={filaments} onChange={setFilaments} />
                        ) : activeTab === 'settings' ? (
                            <PasswordManager />
                        ) : (
                            // ORDERS TAB
                            <>
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-xl font-bold text-white flex items-center gap-2"><ServerIcon className="h-5 w-5 text-brand-400"/> Bestellungen</h2>
                                    <Button onClick={loadData} variant="secondary" size="sm" className="gap-2"><RefreshCw className={`h-4 w-4 ${loading ? 'animate-spin' : ''}`} /> Aktualisieren</Button>
                                </div>
                                <div className="grid gap-4">
                                    {orders.length === 0 ? (
                                        <div className="text-center text-slate-500 py-12 bg-slate-800/30 rounded-xl border border-slate-800 border-dashed"><p>Keine Bestellungen vorhanden.</p></div>
                                    ) : (
                                        orders.map(order => (
                                            <div key={order.id} className="bg-slate-800 border border-slate-700 rounded-xl p-4 md:p-6 shadow-sm hover:border-slate-600 transition-colors">
                                                {editingId === order.id ? (
                                                    <div className="space-y-4 animate-fadeIn bg-slate-900/50 p-4 rounded-lg">
                                                        <div className="flex justify-between items-center border-b border-slate-700 pb-2">
                                                            <h3 className="font-bold text-white">Bestellung bearbeiten</h3>
                                                            <Button onClick={() => setEditingId(null)} variant="ghost" size="sm"><X className="h-4 w-4"/></Button>
                                                        </div>
                                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                            <div><label className="block text-xs text-slate-400 mb-1">Status</label>
                                                                <select value={editForm.status} onChange={e => setEditForm({...editForm, status: e.target.value})} className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white focus:border-brand-500">
                                                                    {Object.entries(ORDER_STATUS).map(([key, val]) => (<option key={val.id} value={val.id}>{val.label}</option>))}
                                                                </select>
                                                            </div>
                                                            <div><label className="block text-xs text-slate-400 mb-1">Notiz</label><textarea value={editForm.adminNotes} onChange={e => setEditForm({...editForm, adminNotes: e.target.value})} className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white text-sm" rows="2"/></div>
                                                        </div>
                                                        <div className="flex justify-end pt-2"><Button onClick={() => saveEditOrder(order.id)} size="sm">Speichern</Button></div>
                                                    </div>
                                                ) : (
                                                    <div className="flex flex-col md:flex-row justify-between gap-4">
                                                        <div className="flex-1 min-w-0">
                                                            <div className="flex flex-wrap items-center gap-2 mb-2">
                                                                <span className={`w-2 h-2 rounded-full ${ORDER_STATUS[order.status.toUpperCase()]?.color.replace('bg-', 'bg-') || 'bg-gray-500'}`}></span>
                                                                <span className="text-xs text-slate-500">{new Date(order.createdAt).toLocaleString()}</span>
                                                                <span className="text-xs px-1.5 py-0.5 rounded bg-slate-700 text-slate-300 font-mono">ID: {order.id.slice(0,6)}</span>
                                                            </div>
                                                            <h4 className="font-bold text-white text-lg">{order.description}</h4>
                                                            <div className="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1 text-sm text-slate-300">
                                                                <div className="flex gap-2"><span className="text-slate-500 w-16">Kunde:</span> <span className="text-white">{order.userName}</span></div>
                                                                <div className="flex gap-2"><span className="text-slate-500 w-16">Email:</span> <span className="text-white truncate">{order.userEmail}</span></div>
                                                                <div className="flex gap-2"><span className="text-slate-500 w-16">Material:</span> <span className="text-brand-300">{order.material}</span></div>
                                                                {order.street && (<div className="col-span-1 sm:col-span-2 flex gap-2 pt-2 border-t border-slate-700/50 mt-1"><span className="text-slate-500 w-16">Adresse:</span> <span className="text-slate-300">{order.street}, {order.zip} {order.city}</span></div>)}
                                                            </div>
                                                            {order.adminNotes && (<div className="mt-3 text-sm text-brand-200 bg-brand-900/20 p-2 rounded border border-brand-500/20 flex items-start gap-2"><Info className="h-4 w-4 mt-0.5 text-brand-500" /><span>{order.adminNotes}</span></div>)}
                                                        </div>
                                                        <div className="flex md:flex-col gap-2 shrink-0 items-end">
                                                            <div className={`px-3 py-1 rounded text-center text-xs font-bold uppercase tracking-wider ${ORDER_STATUS[order.status.toUpperCase()]?.color} ${ORDER_STATUS[order.status.toUpperCase()]?.text}`}>{ORDER_STATUS[order.status.toUpperCase()]?.label}</div>
                                                            <div className="flex gap-2 w-full md:w-auto">
                                                                <Button onClick={() => startEditOrder(order)} variant="secondary" size="sm" className="flex-1 md:w-full"><Edit className="h-4 w-4 mr-2" /> Bearbeiten</Button>
                                                                <Button onClick={() => handleDeleteOrder(order.id)} variant="danger" size="sm"><Trash2 className="h-4 w-4" /></Button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        ))
                                    )}
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // OrderForm Component
        const OrderForm = ({ onCancel, onSubmitSuccess, deviceId, stockFilaments }) => {
            const [formData, setFormData] = React.useState({
                projectDescription: '',
                filamentMode: 'stock',
                selectedFilamentId: null,
                customFilamentRequest: '',
                userName: '',
                userEmail: '',
                userPhone: '',
                street: '',
                zip: '',
                city: ''
            });

            const [selectedMaterialCategory, setSelectedMaterialCategory] = React.useState('PLA');
            const [isSubmitting, setIsSubmitting] = React.useState(false);
            const [showMaterialInfo, setShowMaterialInfo] = React.useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsSubmitting(true);

                const selectedStock = stockFilaments.find(f => f.id === formData.selectedFilamentId);
                let materialText = "";
                if (formData.filamentMode === 'stock' && selectedStock) {
                    materialText = `Lager-Filament: ${selectedStock.name} (${selectedStock.material})`;
                } else {
                    materialText = `Spezialwunsch: ${formData.customFilamentRequest}`;
                }

                try {
                    await ApiService.addOrder({
                        userName: formData.userName,
                        userEmail: formData.userEmail,
                        description: formData.projectDescription,
                        material: materialText,
                        street: formData.street,
                        zip: formData.zip,
                        city: formData.city,
                        userPhone: formData.userPhone
                    }, deviceId);
                    
                    setIsSubmitting(false);
                    onSubmitSuccess(false);
                } catch (error) {
                    alert("Es gab einen Fehler beim Speichern auf dem Server.");
                    console.error(error);
                    setIsSubmitting(false);
                }
            };

            const filteredFilaments = stockFilaments.filter(f => f.material === selectedMaterialCategory);

            return (
                <div className="w-full max-w-4xl mx-auto py-12 px-4 sm:px-6">
                    <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl border border-slate-700 shadow-2xl overflow-hidden">
                         <div className="p-6 md:p-8 border-b border-slate-700 bg-slate-800/80">
                            <h2 className="text-2xl font-bold text-white flex items-center gap-2"><Sparkles className="text-brand-400" /> Projekt Anfrage</h2>
                            <p className="text-slate-400 mt-2">Beschreibe uns dein Projekt. Enrique oder Jack melden sich so schnell wie möglich bei dir.</p>
                        </div>
                        <form onSubmit={handleSubmit} className="p-6 md:p-8 space-y-8">
                            <div className="space-y-4">
                                <label className="block text-sm font-medium text-slate-300 uppercase tracking-wider">1. Was möchtest du drucken?</label>
                                <div className="relative">
                                    <textarea required rows="5" className="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-white placeholder-slate-500 focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all" placeholder="Beschreibe dein Objekt... (Bitte Link zu Thingiverse/Printables einfügen oder 'Datei per Mail' schreiben)" value={formData.projectDescription} onChange={(e) => setFormData({...formData, projectDescription: e.target.value})} name="description"/>
                                </div>
                                <div className="text-xs text-slate-500 mt-2 flex items-start gap-2">
                                    <Info className="h-4 w-4 mt-0.5 text-brand-400" />
                                    <p>Dateien bitte als Link in die Beschreibung einfügen oder nach Absenden der Anfrage per E-Mail an {EMAIL_RECIPIENT} senden.</p>
                                </div>
                            </div>

                             <div className="space-y-4">
                                <label className="block text-sm font-medium text-slate-300 uppercase tracking-wider">2. Material & Farbe auswählen</label>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div onClick={() => setFormData({...formData, filamentMode: 'stock', customFilamentRequest: ''})} className={`cursor-pointer p-4 rounded-xl border-2 transition-all ${formData.filamentMode === 'stock' ? 'border-brand-500 bg-brand-500/10' : 'border-slate-700 bg-slate-800 hover:border-slate-600'}`}>
                                        <div className="flex items-center gap-3 mb-2">
                                            <div className={`w-5 h-5 rounded-full border flex items-center justify-center ${formData.filamentMode === 'stock' ? 'border-brand-500' : 'border-slate-500'}`}>{formData.filamentMode === 'stock' && <div className="w-2.5 h-2.5 bg-brand-500 rounded-full" />}</div>
                                            <span className="font-semibold text-white">Lagerbestand</span>
                                        </div>
                                        <p className="text-sm text-slate-400 ml-8">Wähle aus unseren vorhandenen Filamenten.</p>
                                    </div>
                                    <div onClick={() => setFormData({...formData, filamentMode: 'custom', selectedFilamentId: null})} className={`cursor-pointer p-4 rounded-xl border-2 transition-all ${formData.filamentMode === 'custom' ? 'border-brand-500 bg-brand-500/10' : 'border-slate-700 bg-slate-800 hover:border-slate-600'}`}>
                                        <div className="flex items-center gap-3 mb-2">
                                            <div className={`w-5 h-5 rounded-full border flex items-center justify-center ${formData.filamentMode === 'custom' ? 'border-brand-500' : 'border-slate-500'}`}>{formData.filamentMode === 'custom' && <div className="w-2.5 h-2.5 bg-brand-500 rounded-full" />}</div>
                                            <span className="font-semibold text-white">Spezialwunsch</span>
                                        </div>
                                        <p className="text-sm text-slate-400 ml-8">Wir bestellen eine Farbe/Material extra für dich.</p>
                                    </div>
                                </div>
                                {formData.filamentMode === 'stock' && (
                                    <div className="animate-fadeIn mt-6 space-y-4">
                                        <div className="relative">
                                            <button type="button" onClick={() => setShowMaterialInfo(!showMaterialInfo)} className="w-full py-3 px-4 bg-brand-900/40 border border-brand-500/30 rounded-xl text-brand-200 hover:bg-brand-900/60 hover:text-white transition-all flex items-center justify-center gap-2 group"><HelpCircle className="h-5 w-5 text-brand-400" /><span className="font-medium">Welches Material?</span><ChevronDown className={`h-4 w-4 ml-auto transition-transform ${showMaterialInfo ? 'rotate-180' : ''}`} /></button>
                                            {showMaterialInfo && <div className="mt-3 grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-slate-900 rounded-xl border border-slate-700 animate-fadeIn shadow-xl relative z-10"><div className="p-3 bg-slate-800 rounded-lg"><h4 className="font-bold text-white mb-1">PLA</h4><p className="text-xs text-slate-400">Standard, einfach, für Deko.</p></div><div className="p-3 bg-slate-800 rounded-lg"><h4 className="font-bold text-white mb-1">PETG</h4><p className="text-xs text-slate-400">Robust, witterungsbeständig.</p></div><div className="p-3 bg-slate-800 rounded-lg"><h4 className="font-bold text-white mb-1">TPU</h4><p className="text-xs text-slate-400">Flexibel, gummiartig.</p></div></div>}
                                        </div>
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">1. Materialtyp wählen</label>
                                            <div className="flex p-1 bg-slate-900 rounded-xl border border-slate-700">{['PLA', 'PETG', 'TPU'].map((mat) => (<button key={mat} type="button" onClick={() => setSelectedMaterialCategory(mat)} className={`flex-1 py-2 px-4 rounded-lg text-sm font-semibold transition-all ${selectedMaterialCategory === mat ? 'bg-slate-700 text-white shadow-md' : 'text-slate-400 hover:text-white hover:bg-slate-800'}`}>{mat}</button>))}</div>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">2. Farbe wählen</label>
                                            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 animate-fadeIn">
                                                {filteredFilaments.length > 0 ? (filteredFilaments.map(filament => (<div key={filament.id} className="relative group"><button type="button" disabled={!filament.inStock} onClick={() => setFormData({...formData, selectedFilamentId: filament.id})} className={`w-full relative p-3 rounded-lg border text-left transition-all ${formData.selectedFilamentId === filament.id ? 'border-brand-500 ring-1 ring-brand-500 bg-slate-800' : 'border-slate-700 bg-slate-900 hover:border-slate-500'} ${!filament.inStock ? 'opacity-50 cursor-not-allowed' : ''}`}><div className="flex items-center justify-between mb-2"><div className="w-6 h-6 rounded-full border border-slate-600 shadow-sm" style={{backgroundColor: filament.colorHex}} />{filament.material === 'TPU' && <span className="text-[10px] font-bold bg-slate-700 px-1 rounded text-slate-300">FLEX</span>}</div><div className="text-sm font-medium text-white truncate pr-4">{filament.name}</div><div className="text-xs text-slate-500">{filament.color}</div>{!filament.inStock && <div className="absolute inset-0 bg-slate-900/60 flex items-center justify-center rounded-lg backdrop-blur-[1px] z-10"><span className="text-xs font-bold text-red-400 transform -rotate-12 border border-red-400 px-2 py-1 rounded shadow-lg bg-slate-900/50">Ausverkauft</span></div>}</button></div>))) : (<div className="col-span-full py-8 text-center text-slate-500 bg-slate-900/30 rounded-lg border border-slate-800 border-dashed"><p>Keine Farben verfügbar.</p></div>)}
                                            </div>
                                        </div>
                                    </div>
                                )}
                                {formData.filamentMode === 'custom' && <div className="mt-4 animate-fadeIn"><textarea required rows="2" className="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-white placeholder-slate-500 focus:ring-2 focus:ring-brand-500" placeholder="Welche Farbe?" value={formData.customFilamentRequest} onChange={(e) => setFormData({...formData, customFilamentRequest: e.target.value})} /><div className="flex items-start gap-2 mt-2 text-amber-400 text-sm"><AlertCircle className="h-4 w-4 mt-0.5" /><p>Aufpreis {CUSTOM_FILAMENT_SURCHARGE.toFixed(2)} CHF.</p></div></div>}
                            </div>

                            <div className="space-y-4">
                                <label className="block text-sm font-medium text-slate-300 uppercase tracking-wider">3. Deine Kontaktdaten & Lieferadresse</label>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label className="block text-xs text-slate-500 mb-1">Name</label><input type="text" required className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-brand-500" placeholder="Dein Name" value={formData.userName} onChange={(e) => setFormData({...formData, userName: e.target.value})} name="name"/></div>
                                    <div><label className="block text-xs text-slate-500 mb-1">E-Mail</label><input type="email" required className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-brand-500" placeholder="email@example.com" value={formData.userEmail} onChange={(e) => setFormData({...formData, userEmail: e.target.value})} name="email"/></div>
                                    <div className="md:col-span-2"><label className="block text-xs text-slate-500 mb-1">Telefon</label><input type="tel" className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-brand-500" placeholder="+41..." value={formData.userPhone} onChange={(e) => setFormData({...formData, userPhone: e.target.value})} name="phone"/></div>
                                    <div className="md:col-span-2 border-t border-slate-700 pt-2 mt-2"><label className="block text-xs font-semibold text-slate-400 mb-2 uppercase tracking-wider">Lieferadresse</label></div>
                                    <div className="md:col-span-2"><label className="block text-xs text-slate-500 mb-1">Straße & Hausnummer</label><input type="text" required className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-brand-500" placeholder="Musterstraße 12" value={formData.street} onChange={(e) => setFormData({...formData, street: e.target.value})} /></div>
                                    <div><label className="block text-xs text-slate-500 mb-1">PLZ</label><input type="text" required className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-brand-500" placeholder="8427" value={formData.zip} onChange={(e) => setFormData({...formData, zip: e.target.value})} /></div>
                                    <div><label className="block text-xs text-slate-500 mb-1">Ort</label><input type="text" required className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-brand-500" placeholder="Rorbas" value={formData.city} onChange={(e) => setFormData({...formData, city: e.target.value})} /></div>
                                </div>
                            </div>

                            <div className="pt-6 border-t border-slate-700 flex flex-col sm:flex-row items-center gap-4 justify-end">
                                <Button type="button" variant="ghost" onClick={onCancel}>Abbrechen</Button>
                                <Button type="submit" disabled={isSubmitting || (formData.filamentMode === 'stock' && !formData.selectedFilamentId)}>{isSubmitting ? "Wird gesendet..." : "Anfrage Absenden"}</Button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Banned Screen Component
        const BannedScreen = () => (
            <div className="min-h-screen bg-red-950 flex flex-col items-center justify-center px-4 text-center">
                <div className="p-8 bg-red-900/50 border border-red-500/50 rounded-2xl shadow-2xl backdrop-blur-md max-w-md w-full">
                    <div className="w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                        <ShieldBan className="h-10 w-10 text-red-500" />
                    </div>
                    <h1 className="text-3xl font-bold text-white mb-4">Zugriff Verweigert</h1>
                    <p className="text-red-200 mb-6 text-lg">
                        Dein Gerät wurde gesperrt. <br/>
                        Enrique & Jack tolerieren keinen Missbrauch.
                    </p>
                    <div className="text-xs text-red-400 font-mono bg-red-950/50 p-2 rounded">
                        Error: DEVICE_BLACKLISTED
                    </div>
                </div>
            </div>
        );

        // Navbar Component
        const Navbar = ({ currentView, onNavigate, hasOrders }) => {
            const [isOpen, setIsOpen] = React.useState(false);

            if (currentView === ViewState.BANNED) return null;

            return (
                <nav className="fixed w-full z-50 bg-slate-900/80 backdrop-blur-md border-b border-slate-800">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex items-center justify-between h-16">
                            <div 
                                className="flex items-center gap-2 cursor-pointer group"
                                onClick={() => onNavigate(ViewState.HOME)}
                            >
                                <div className="p-2 bg-brand-500/10 rounded-lg group-hover:bg-brand-500/20 transition-colors">
                                    <Printer className="h-6 w-6 text-brand-400" />
                                </div>
                                <span className="font-bold text-xl tracking-tight text-white">
                                    Rorbas<span className="text-brand-400">3D</span>
                                </span>
                            </div>
                            
                            <div className="hidden md:block">
                                <div className="ml-10 flex items-baseline space-x-8">
                                    <button 
                                        onClick={() => onNavigate(ViewState.HOME)}
                                        className={`${currentView === ViewState.HOME ? 'text-white' : 'text-slate-400'} hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors`}
                                    >
                                        Home
                                    </button>
                                    
                                    {hasOrders && (
                                        <button 
                                            onClick={() => onNavigate(ViewState.MY_ORDERS)}
                                            className={`${currentView === ViewState.MY_ORDERS ? 'text-white' : 'text-brand-400'} hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center gap-2`}
                                        >
                                            <Box className="h-4 w-4" /> Meine Bestellungen
                                        </button>
                                    )}

                                    <button 
                                        onClick={() => onNavigate(ViewState.ORDER)}
                                        className="bg-brand-600 hover:bg-brand-500 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-lg shadow-brand-500/20"
                                    >
                                        Jetzt Drucken
                                    </button>
                                </div>
                            </div>

                            <div className="-mr-2 flex md:hidden">
                                <button
                                    onClick={() => setIsOpen(!isOpen)}
                                    className="inline-flex items-center justify-center p-2 rounded-md text-slate-400 hover:text-white hover:bg-slate-800 focus:outline-none"
                                >
                                    {isOpen ? <X className="h-6 w-6" /> : <Menu className="h-6 w-6" />}
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Mobile menu */}
                    {isOpen && (
                        <div className="md:hidden bg-slate-900 border-b border-slate-800">
                            <div className="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                                <button
                                    onClick={() => { onNavigate(ViewState.HOME); setIsOpen(false); }}
                                    className="text-slate-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium w-full text-left"
                                >
                                    Home
                                </button>
                                {hasOrders && (
                                    <button
                                        onClick={() => { onNavigate(ViewState.MY_ORDERS); setIsOpen(false); }}
                                        className="text-brand-400 hover:text-white block px-3 py-2 rounded-md text-base font-medium w-full text-left"
                                    >
                                        Meine Bestellungen
                                    </button>
                                )}
                                <button
                                    onClick={() => { onNavigate(ViewState.ORDER); setIsOpen(false); }}
                                    className="bg-brand-600 text-white block px-3 py-2 rounded-md text-base font-medium w-full text-left"
                                >
                                    Jetzt starten
                                </button>
                                <button
                                    onClick={() => { onNavigate(ViewState.AGB); setIsOpen(false); }}
                                    className="text-slate-400 hover:text-white block px-3 py-2 rounded-md text-sm w-full text-left border-t border-slate-800 mt-2"
                                >
                                    AGB
                                </button>
                            </div>
                        </div>
                    )}
                </nav>
            );
        };

        // Hero Component
        const Hero = ({ onStart }) => {
            const [activeFeature, setActiveFeature] = React.useState(null);

            const features = [
                {
                    icon: <Box className="h-8 w-8 text-brand-400" />,
                    title: "Individuell",
                    desc: "Jedes Teil wird genau nach deinen Wünschen und Maßen gefertigt.",
                    details: "Egal ob eine fertige STL-Datei oder nur eine grobe Skizze: Wir beraten dich zur Machbarkeit. Wir passen Füllung, Wandstärke und Auflösung genau an den Verwendungszweck an, damit dein Teil perfekt passt."
                },
                {
                    icon: <Zap className="h-8 w-8 text-brand-400" />,
                    title: "Schnell & Lokal",
                    desc: "Direkt aus Rorbas. Keine langen Lieferwege, direkter Kontakt.",
                    details: "Wir produzieren vor Ort in Rorbas. Das spart Versandzeit und schont die Umwelt. Du kannst deine Drucke oft schon nach wenigen Tagen direkt abholen oder wir senden sie dir schnell per Post zu."
                },
                {
                    icon: <Heart className="h-8 w-8 text-brand-400" />,
                    title: "Leidenschaft",
                    desc: "Gedruckt von Enthusiasten (Enrique & Jack), die Qualität lieben.",
                    details: "Wir sind keine industrielle Massenfertigung. Jedes Teil wird von uns persönlich begutachtet. Wenn die Qualität nicht stimmt, drucken wir es neu. Wir stecken Herzblut in jeden Layer."
                }
            ];

            return (
                <div className="relative pt-24 pb-16 lg:pt-32 lg:pb-24 overflow-hidden">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
                        <div className="text-center max-w-3xl mx-auto">
                            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-brand-500/10 border border-brand-500/20 text-brand-300 text-sm font-medium mb-6">
                                <span className="relative flex h-2 w-2">
                                    <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-brand-400 opacity-75"></span>
                                    <span className="relative inline-flex rounded-full h-2 w-2 bg-brand-500"></span>
                                </span>
                                1 Woche Ferien
                            </div>
                            
                            <h1 className="text-4xl md:text-6xl font-bold tracking-tight text-white mb-6">
                                Deine Ideen. <br />
                                <span className="text-transparent bg-clip-text bg-gradient-to-r from-brand-400 to-indigo-500">
                                    Dreidimensional realisiert.
                                </span>
                            </h1>
                            
                            <p className="text-lg md:text-xl text-slate-400 mb-8 leading-relaxed">
                                Willkommen bei Rorbas 3D Druck. Wir sind Enrique und Jack – deine lokalen Experten für personalisierte 3D-Drucke. Von Prototypen bis zu einzigartigen Geschenken, wir machen es möglich.
                            </p>

                            <div className="flex flex-col sm:flex-row gap-4 justify-center items-center">
                                <Button onClick={onStart} size="lg" className="w-full sm:w-auto gap-2">
                                    Projekt Starten <ArrowRight className="h-5 w-5" />
                                </Button>
                                <Button variant="outline" size="lg" className="w-full sm:w-auto" onClick={() => document.getElementById('how-it-works')?.scrollIntoView({ behavior: 'smooth'})}>
                                    Wie es funktioniert
                                </Button>
                            </div>
                        </div>
                        
                        <div className="mt-20 grid grid-cols-1 md:grid-cols-3 gap-8">
                            {features.map((feature, idx) => (
                                <div 
                                    key={idx} 
                                    onClick={() => setActiveFeature(activeFeature === idx ? null : idx)}
                                    className={`relative p-6 rounded-2xl border transition-all duration-300 cursor-pointer group ${
                                        activeFeature === idx 
                                        ? 'bg-slate-800 border-brand-500 ring-1 ring-brand-500 shadow-lg shadow-brand-500/10' 
                                        : 'bg-slate-800/50 border-slate-700 hover:border-brand-500/30 hover:-translate-y-1'
                                    }`}
                                >
                                    <div className="flex justify-between items-start mb-4">
                                        <div className="p-3 bg-slate-900 rounded-lg inline-block">
                                            {feature.icon}
                                        </div>
                                        <div className={`transition-transform duration-300 text-slate-500 ${activeFeature === idx ? 'rotate-180 text-brand-400' : 'group-hover:text-slate-300'}`}>
                                            <ChevronDown className="h-5 w-5" />
                                        </div>
                                    </div>
                                    <h3 className={`text-xl font-semibold mb-2 transition-colors ${activeFeature === idx ? 'text-brand-400' : 'text-white'}`}>{feature.title}</h3>
                                    <div className="relative overflow-hidden">
                                        <p className={`text-slate-400 transition-all duration-300 ${activeFeature === idx ? 'opacity-0 h-0' : 'opacity-100'}`}>{feature.desc}</p>
                                        <p className={`text-slate-300 leading-relaxed transition-all duration-500 ${activeFeature === idx ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-4 absolute top-0 left-0 pointer-events-none'}`}>{feature.details}</p>
                                    </div>
                                    <div className={`mt-4 text-xs font-medium text-brand-500 uppercase tracking-wide transition-opacity duration-300 ${activeFeature === idx ? 'opacity-0 h-0' : 'opacity-100'}`}>Mehr erfahren</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="absolute top-0 left-1/2 -translate-x-1/2 w-full h-full -z-10 pointer-events-none">
                        <div className="absolute top-0 left-1/4 w-96 h-96 bg-brand-600/20 rounded-full blur-[100px]"></div>
                        <div className="absolute bottom-0 right-1/4 w-96 h-96 bg-indigo-600/20 rounded-full blur-[100px]"></div>
                    </div>
                </div>
            );
        };

        // HowItWorks Component
        const HowItWorks = () => {
             return (
                <section id="how-it-works" className="py-20 bg-slate-900">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="text-center mb-16">
                            <h2 className="text-3xl font-bold text-white mb-4">So funktioniert's</h2>
                            <p className="text-slate-400 max-w-2xl mx-auto">
                                In drei einfachen Schritten zu deinem fertigen Objekt.
                            </p>
                        </div>
                        <div className="relative">
                            <div className="hidden md:block absolute top-1/2 left-0 w-full h-0.5 bg-slate-800 -translate-y-1/2 z-0"></div>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-12 relative z-10">
                                {[
                                    { icon: <ClipboardList className="h-10 w-10" />, title: "1. Anfrage senden", desc: "Fülle unser Formular aus. Beschreibe deine Idee oder lade eine Datei hoch." },
                                    { icon: <Settings className="h-10 w-10" />, title: "2. Wir drucken", desc: "Enrique und Jack prüfen die Machbarkeit und starten die Drucker." },
                                    { icon: <Truck className="h-10 w-10" />, title: "3. Abholen / Versand", desc: "Sobald es fertig ist, informieren wir dich per E-Mail." }
                                ].map((step, idx) => (
                                    <div key={idx} className="flex flex-col items-center text-center">
                                        <div className="w-20 h-20 rounded-full bg-slate-800 border-4 border-slate-900 flex items-center justify-center mb-6 shadow-xl relative group">
                                            <div className="text-brand-400 group-hover:scale-110 transition-transform duration-300">{step.icon}</div>
                                            <div className="absolute -bottom-3 bg-brand-600 text-white text-xs font-bold px-2 py-1 rounded-full">Schritt {idx + 1}</div>
                                        </div>
                                        <h3 className="text-xl font-semibold text-white mb-2">{step.title}</h3>
                                        <p className="text-slate-400 text-sm leading-relaxed max-w-xs">{step.desc}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </section>
            );
        };

        // Footer Component
        const Footer = ({ onNavigate }) => {
            return (
                <footer className="bg-slate-950 py-12 border-t border-slate-800 text-slate-400 relative">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div><h3 className="text-white font-bold text-lg mb-4">Rorbas 3D Druck</h3><p className="mb-4 text-sm max-w-xs">Dein lokaler Partner für Rapid Prototyping.</p></div>
                            <div className="flex flex-col md:items-end"><h3 className="text-white font-bold text-lg mb-4">Kontakt</h3><a href={`mailto:${EMAIL_RECIPIENT}`} className="flex items-center gap-2 hover:text-brand-400 transition-colors mb-2"><Mail className="h-4 w-4" /> {EMAIL_RECIPIENT}</a><div className="flex items-center gap-2"><MapPin className="h-4 w-4" /> Rorbas, Schweiz</div></div>
                        </div>
                        <div className="mt-12 pt-8 border-t border-slate-900 flex flex-col md:flex-row justify-between items-center gap-4 text-xs text-slate-600">
                            <div>&copy; {new Date().getFullYear()} Rorbas 3D Druck. Alle Rechte vorbehalten.</div>
                            <button onClick={() => onNavigate(ViewState.AGB)} className="hover:text-brand-400 transition-colors underline decoration-slate-800 underline-offset-4 hover:decoration-brand-400">AGB & Rechtliches</button>
                        </div>
                    </div>
                    {/* Hidden Admin Button with 30% opacity */}
                    <button onClick={() => onNavigate(ViewState.ADMIN_LOGIN)} className="absolute bottom-2 right-2 p-2 opacity-30 hover:opacity-100 transition-opacity text-slate-500 hover:text-white" title="Interner Bereich"><Lock className="h-3 w-3" /></button>
                </footer>
            );
        };

        // Main App Component
        const App = () => {
            const [view, setView] = React.useState(ViewState.HOME);
            const [deviceId, setDeviceId] = React.useState('');
            const [hasOrders, setHasOrders] = React.useState(false);
            const [currentUser, setCurrentUser] = React.useState(null);
            const [filaments, setFilaments] = React.useState([]);

            // Fetch initial data
            React.useEffect(() => {
                const id = getDeviceId();
                setDeviceId(id);
                if (BLACKLISTED_IDS.includes(id)) {
                    setView(ViewState.BANNED);
                } else {
                    ApiService.getOrders(id).then(orders => setHasOrders(orders.length > 0));
                }
                // Always fetch filaments
                ApiService.getFilaments().then(setFilaments);
            }, []);

            const handleStartOrder = () => {
                setView(ViewState.ORDER);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const handleOrderSuccess = () => {
                // Update state immediately without reload
                setHasOrders(true);
                setView(ViewState.SUCCESS);
                // Background refresh to ensure sync
                ApiService.getOrders(deviceId).then(orders => setHasOrders(orders.length > 0));
            };
            
            const handleAdminLogin = (user) => {
                setCurrentUser(user);
                setView(ViewState.ADMIN_DASHBOARD);
            };

            const handleLogout = () => {
                setCurrentUser(null);
                setView(ViewState.HOME);
            };

            if (view === ViewState.BANNED) {
                return <BannedScreen />;
            }

            return (
                <div className="min-h-screen bg-slate-950 flex flex-col font-sans">
                    {/* Navbar hides on Admin Dashboard to focus view */}
                    {view !== ViewState.ADMIN_DASHBOARD && view !== ViewState.ADMIN_LOGIN && (
                        <Navbar currentView={view} onNavigate={setView} hasOrders={hasOrders} />
                    )}
                    
                    <main className="flex-grow pt-16">
                        {view === ViewState.HOME && (
                            <div className="animate-fadeIn">
                                <Hero onStart={handleStartOrder} />
                                <HowItWorks />
                            </div>
                        )}

                        {view === ViewState.ORDER && (
                            <div className="animate-slideUp">
                                <OrderForm 
                                    onCancel={() => setView(ViewState.HOME)} 
                                    onSubmitSuccess={handleOrderSuccess}
                                    deviceId={deviceId}
                                    stockFilaments={filaments}
                                />
                            </div>
                        )}

                        {view === ViewState.SUCCESS && (
                            <div className="min-h-[60vh] flex items-center justify-center px-4 animate-scaleIn">
                                <div className="text-center max-w-lg mx-auto p-8 rounded-2xl bg-slate-800/50 border border-brand-500/30 relative overflow-hidden">
                                    <div className="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <CheckCircle2 className="h-10 w-10 text-green-400" />
                                    </div>
                                    <h2 className="text-3xl font-bold text-white mb-4">Anfrage erfolgreich gesendet!</h2>
                                    <p className="text-slate-300 mb-6 leading-relaxed">Vielen Dank! Wir haben deine Anfrage erhalten. Deine Bestellung ist nun in deinem Verlauf sichtbar.</p>
                                    <div className="flex flex-col gap-3">
                                        <Button onClick={() => setView(ViewState.MY_ORDERS)} variant="primary">Meine Bestellung ansehen</Button>
                                        <Button onClick={() => setView(ViewState.HOME)} variant="ghost">Zurück zur Startseite</Button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === ViewState.AGB && <AGBView onBack={() => setView(ViewState.HOME)} />}

                        {view === ViewState.MY_ORDERS && (
                            <MyOrdersView deviceId={deviceId} onBack={() => setView(ViewState.HOME)} />
                        )}

                        {view === ViewState.ADMIN_LOGIN && (
                            <AdminLoginView onLogin={handleAdminLogin} onBack={() => setView(ViewState.HOME)} />
                        )}

                        {view === ViewState.ADMIN_DASHBOARD && (
                            <AdminDashboard currentUser={currentUser} onLogout={handleLogout} />
                        )}
                    </main>

                    {view !== ViewState.ADMIN_DASHBOARD && view !== ViewState.ADMIN_LOGIN && (
                        <Footer onNavigate={setView} />
                    )}
                </div>
            );
        };

        // Render Application
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
